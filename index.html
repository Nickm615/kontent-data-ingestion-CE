<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATDW Data Warehouse Integration</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        button {
            background: #f05a28;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        button:hover {
            background: #d64d21;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin: 15px 0;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .data-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 12px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h2>ATDW Data Warehouse Integration</h2>
    <p>Click the button below to fetch tourism listing data from ATDW and save it to Kontent.ai</p>
    
    <button id="fetchBtn">Fetch Data from ATDW</button>
    
    <div id="status" class="status hidden"></div>
    
    <div id="dataPreview" class="data-preview hidden">
        <strong>Fetched Tourism Listing:</strong>
        <pre id="dataContent"></pre>
    </div>

    <script src="https://app.kontent.ai/js-api/custom-element/v1/custom-element.min.js"></script>
    <script>
        let CustomElement;
        
        // Initialize Kontent.ai Custom Element
        CustomElement = window.CustomElement;
        CustomElement.init((element, context) => {
            console.log('Custom Element initialized', element, context);
            
            // If there's existing value, display it
            if (element.value) {
                try {
                    const existingData = JSON.parse(element.value);
                    displayData(existingData);
                    showStatus('Previously saved ATDW data loaded', 'info');
                } catch (e) {
                    console.error('Error parsing existing value', e);
                }
            }
            
            // Update height for Kontent.ai iframe
            CustomElement.setHeight(500);
        });

        const fetchBtn = document.getElementById('fetchBtn');
        const statusDiv = document.getElementById('status');
        const dataPreview = document.getElementById('dataPreview');
        const dataContent = document.getElementById('dataContent');

        fetchBtn.addEventListener('click', async () => {
            fetchBtn.disabled = true;
            showStatus('Fetching tourism listing from ATDW...', 'info');
            
            try {
                // Simulate ATDW API call with realistic tourism data
                // In production, this would be: await fetch('https://your-atdw-endpoint...')
                const atdwMockData = await simulateATDWAPICall();
                
                // Wrap in metadata to show this came from external source
                const warehouseData = {
                    retrievedAt: new Date().toISOString(),
                    source: 'ATDW-ATLAS-API',
                    apiVersion: 'v2',
                    product: atdwMockData
                };
                
                // Display the data
                displayData(warehouseData);
                
                // Save to Kontent.ai
                const valueToSave = JSON.stringify(warehouseData);
                CustomElement.setValue(valueToSave);
                
                showStatus('âœ“ ATDW tourism listing successfully fetched and saved to Kontent.ai!', 'success');
                
            } catch (error) {
                console.error('Error fetching data:', error);
                showStatus(`Error: ${error.message}`, 'error');
            } finally {
                fetchBtn.disabled = false;
            }
        });

        // Simulate ATDW API response with realistic tourism data structure
        async function simulateATDWAPICall() {
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 800));
            
            // Mock ATDW product structure based on their API documentation
            return {
                productId: "56b25d272880253d74c4464d",
                productName: "Great Barrier Reef Snorkeling Adventure",
                productCategory: "TOUR",
                productClassification: "DAY_TOUR",
                productDescription: "Experience the wonder of the Great Barrier Reef with our full-day snorkeling adventure. Explore pristine coral reefs, encounter diverse marine life, and create memories that will last a lifetime. Our experienced guides ensure a safe and unforgettable journey through one of the world's most spectacular natural wonders.",
                physicalAddress: {
                    addressLine: "Reef Fleet Terminal, 1 Spence Street",
                    city: "Cairns",
                    state: "Queensland",
                    postcode: "4870",
                    country: "Australia",
                    latitude: -16.9203,
                    longitude: 145.7781
                },
                contact: {
                    email: "bookings@reefadventures.com.au",
                    phone: "+61 7 4051 5644",
                    website: "https://www.reefadventures.com.au"
                },
                attributes: [
                    {
                        attributeTypeId: "EXPERIENCE",
                        attributeType: "Experience Type",
                        attributeId: "WILDLIFE",
                        attributeName: "Wildlife & Nature"
                    },
                    {
                        attributeTypeId: "ACCESSIBILITY",
                        attributeType: "Accessibility",
                        attributeId: "WHEELCHAIR_ACCESS",
                        attributeName: "Wheelchair accessible"
                    },
                    {
                        attributeTypeId: "ACCREDITN",
                        attributeType: "Accreditation",
                        attributeId: "ECOTOURISM",
                        attributeName: "ECO Tourism Certified"
                    }
                ],
                pricing: {
                    adult: {
                        price: 195.00,
                        currency: "AUD",
                        priceType: "per person"
                    },
                    child: {
                        price: 125.00,
                        currency: "AUD",
                        priceType: "per person"
                    }
                },
                multimedia: [
                    {
                        mediaType: "image",
                        serverPath: "https://assets.atdw.com.au/reef-snorkel-main.jpg",
                        fileSize: 2048576,
                        width: 1920,
                        height: 1080,
                        caption: "Snorkeling the Great Barrier Reef"
                    }
                ],
                operatingHours: {
                    monday: { open: "07:30", close: "17:00" },
                    tuesday: { open: "07:30", close: "17:00" },
                    wednesday: { open: "07:30", close: "17:00" },
                    thursday: { open: "07:30", close: "17:00" },
                    friday: { open: "07:30", close: "17:00" },
                    saturday: { open: "07:30", close: "17:00" },
                    sunday: { open: "07:30", close: "17:00" }
                },
                bookingDetails: {
                    bookingRequired: true,
                    instantConfirmation: true,
                    bookingURL: "https://www.reefadventures.com.au/book"
                },
                lastUpdated: "2024-12-05T08:30:00Z",
                productStatus: "ACTIVE"
            };
        }

        function displayData(data) {
            dataContent.textContent = JSON.stringify(data, null, 2);
            dataPreview.classList.remove('hidden');
        }

        function showStatus(message, type) {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.classList.remove('hidden');
        }
    </script>
</body>
</html>